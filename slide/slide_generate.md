6. スライド生成（描画系）は、slides_plan.jsonをもとに見た目のあるスライド資産（MD/HTML/CSS→PDF/PNG）へ確定させる工程です。テンプレごとの整形・図や画像の自動生成・禁則やフォント等の“読みやすさ”処理・書き出し最適化までを一気通貫で回します。

1) 入出力の整理

入力：slides_plan.json（sectionId / template / fields / constraintsResult / notes）

中間：slides_src/（テンプレ適用後のMarkdown/HTML/CSS）

出力：slides_export/（PDF, 必要ならPNG化）→ Canvaへアップロード

2) パイプライン全体像

テンプレ解決：各sectionIdに対してtemplateを確定（前工程の結果を利用）。

フィールド整形：fieldsのテキストを行長・行数に合わせて整形（短文化/改行）。

レンダリング用変換：テンプレごとにMD or HTML/CSSへマッピング。

追加生成（テンプレ別オプション）

illustration：画像生成AIを呼び出し → 画像保存

diagram：テキスト→SVG（関係図/フロー）を自動生成

Typo & 日本語組版ケア：禁則処理/ぶら下がり/全角記号のまとめ直し。

Marpでスライド化：MD→PDF/PNGに書き出し（テーマ/余白/フォント指定）。

最適化：画像圧縮・フォント埋め込み確認・ページネーション/ノンブル。

Canvaへ投入：PDFアップロード→微アニメ/位置調整→最終書き出し。

3) テンプレ→マークアップの作り方（代表例）

文字は全角24〜28字/行、3〜6行/枚を目安に整形します。

a) title_card

狙い：セクションの入口で主旨を一発提示。
MD例

---
marp: true
paginate: true
---

# AIと人間の役割分担
**この章の狙い**：作業の切り分けを理解する

b) definition

狙い：用語の定義を短く強調。
HTML/CSS例（MD内HTMLでもOK）

<section class="definition">
  <h2>プロンプト（prompt）</h2>
  <p>AIに指示する文章。出力の品質を左右する。</p>
</section>

c) bullets

狙い：要点3〜5。2以下はdefinitionへフォールバック。

## AIと人間の役割分担
- 企画は人間が担当
- 整形・構成はAIが補助
- 最終チェックは人が行う

d) comparison

狙い：A/B比較。表は3×3程度に抑える。

## 自動化の切り分け
| 項目 | AI | 人間 |
|---|---|---|
| 台本整形 | 得意 | 監修 |
| 間（ま）調整 | 目安生成 | 最終判断 |

e) process

狙い：手順。5ステップ以内を推奨。

## 書き出し手順
1. JSON→MD/HTML変換
2. 画像/図の自動生成
3. 禁則・行長調整
4. MarpでPDF化
5. Canvaで微調整

4) テンプレ別の追加処理（自動化の肝）
イラスト（illustration）

fields.promptから画像生成AIを叩き、/assets/img/へ保存（WebP/PNG）。

画像は最小幅40%を保証。キャプションは24字以内。

著作権・利用規約に触れないプロンプトに正規化（人物名・商標は避ける等）。

図解（diagram）

関係/フローはSVGで生成（テキストからノード/エッジに変換）。

凡例（legend）必須、色数は5色以内、ノード間隔は最小値で揃える。

生成後に**自動レイアウト（力学/グリッド）**で衝突回避。

5) 日本語の読みやすさ処理（CJK向け）

禁則処理：行頭の句読点・閉じ括弧・長音「ー」を回避。

ぶら下がり：終わりの句読点を1文字ぶら下げ、行長を整える。

記号の全角統一：カギ括弧・ダッシュは全角に揃える。

語切れ防止：助詞直前での改行を避ける（は/が/を/に/でなどの前で改行しない）。

数字のまとまり：4桁以上は1,234表記、単位は半角＋全角の混在を避ける。

これらは整形フィルタとして自動適用し、Marpに渡す前にクリーンにします。

6) フォントと配色（見え方を決める重要要素）

フォント：可読性重視

ゴシック系（例：Noto Sans JP / BIZ UDP ゴシック）を基本。

PDFに埋め込み（Canva取り込み時の置換防止）。

サイズ：

見出し ≥ 48px、本文 32–36px を基準（フルHD想定）。

配色：

コントラスト比（WCAG AA目安）を満たす。

強調色は1〜2色に限定、薄灰の多用で“抜け”を作る。