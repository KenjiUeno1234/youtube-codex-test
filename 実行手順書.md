# YouTube解説動画スライド生成システム - 実行手順書

## 概要

本システムは、テキスト原稿からYouTube解説動画用のスライドを自動生成するMVP（Minimum Viable Product）です。**HTML/CSS形式**で出力し、`input/slide_templates_from_image.pdf`のデザインに近いダークテーマのスライドを生成します。

## システム構成

以下の4つのステップで構成されており、各ステップが対応する出力ファイルを生成します:

1. **セクション分割とメタ情報付与** (`03_sections.js`) → `output/01_sections.json`
2. **スライド設計（テンプレート×制約）** (Claude Code 4.5 Sonnet) → `output/02_slides_plan.json`
3. **プロンプト設計と自動チューニング** (`05_tune.js`) → `output/03_slides_tuned.json`
4. **スライド生成（HTML/CSS）** (`06_render_html.js`) → `output/slides_export/deck.html`

### 最終成果物

- **HTML/CSSスライド** → `output/slides_export/deck.html` + `styles.css`
  - ダークグレー背景（#2a2a2a → #1a1a1a）
  - 紫/ピンクのアクセントカラー（#c77dff, #7dd3c0）
  - 白文字（#ffffff, #e0e0e0）
  - 大きなフォントサイズ（72px〜36px）
  - キーボード操作対応（← →キーでスライド移動）

### 任意の追加ステップ

- **Markdown生成** (`06_render.js`) → `output/slides_src/deck.md`
- **PDF生成** (Marp CLI) → `output/slides_export/deck.pdf`

## 前提条件

### 必要なソフトウェア

- Node.js (v14以上)
- npm

### 任意のソフトウェア

- Marp CLI（PDF/HTML生成する場合）
  - 初回実行時に `npx` で自動ダウンロードされます
  - 頻繁に使用する場合: `npm i -D @marp-team/marp-cli`

### 推奨：Claude Code 4.5 Sonnetの活用

スライド設計（②）で高品質な要約を得るために、**Claude Code 4.5 Sonnetに直接依頼する方法**を推奨します。

**使用方法:**
- Claude Codeに「01_sections.jsonを読み取って02_slides_plan.jsonを生成して」と依頼するだけ

**メリット:**
- **API キー不要**
- 長文を適切な長さに自動要約
- 途中で切れることがない高品質な要点抽出
- 重要なポイントだけを的確に抽出
- すべてのテンプレート（bullets、list_toc、process、definition、comparison、cta等）に完全対応
- 制約（最大文字数、最大項目数）を完全に遵守

**注意:** 自動実行（`npm run plan`）では長文が途中で切れる可能性があります。

### プロジェクト構造

```
youtube-test/
├── input/                          # 入力ファイル
│   ├── sample.txt                  # サンプル原稿
│   └── script_final.md             # 実際の原稿（Markdown形式）
├── output/                         # 出力ファイル
│   ├── 01_sections.json            # ①セクション分割の出力
│   ├── 02_slides_plan.json         # ②スライド設計の出力
│   ├── 03_slides_tuned.json        # ③チューニングの出力
│   ├── slides_src/                 # Markdown出力
│   │   └── deck.md                 # ④Marp形式Markdown
│   └── slides_export/              # 変換後の出力（任意）
│       ├── deck.pdf                # PDFスライド
│       └── deck.html               # HTMLスライド
├── config/                         # 設定ファイル
│   ├── mapping.json                # インテント→テンプレートマッピング
│   ├── slide.schema.json           # スライドスキーマ定義
│   └── theme.css                   # Marp用テーマファイル
├── src/                            # ソースコード
│   ├── 03_sections.js              # ①セクション分割
│   ├── 04_plan.js                  # ②スライド設計
│   ├── 05_tune.js                  # ③チューニング（静的チェック）
│   ├── 06_render.js                # ④Markdown/HTML/CSS生成
│   └── utils.js                    # 共有ユーティリティ
└── package.json                    # npm設定
```

## 実行手順

### 方法1: 一括実行（推奨）

原稿を用意してから、以下のコマンドを実行します。

#### HTML/CSS形式で出力（推奨）

```bash
npm run build
```

このコマンドは以下を順次実行します:
1. セクション分割 → `output/01_sections.json`
2. スライド設計（フォールバック方式）→ `output/02_slides_plan.json`
3. プロンプト設計と自動チューニング → `output/03_slides_tuned.json`
4. HTML/CSS生成 → `output/slides_export/deck.html` + `styles.css`

**注意:** 高品質な要約を得るには、②のスライド設計でClaude Code 4.5 Sonnetを使用することを推奨します（後述）。

#### Markdown形式で出力

```bash
npm run build:md
```

このコマンドは以下を順次実行します:
1. セクション分割 → `output/01_sections.json`
2. スライド設計（フォールバック方式）→ `output/02_slides_plan.json`
3. プロンプト設計と自動チューニング → `output/03_slides_tuned.json`
4. Markdown生成 → `output/slides_src/deck.md`

#### Markdown + PDF形式で出力

```bash
npm run build:pdf
```

このコマンドは上記の処理に加えて、PDFへの変換も実行します:
1. セクション分割 → `output/01_sections.json`
2. スライド設計（フォールバック方式）→ `output/02_slides_plan.json`
3. プロンプト設計と自動チューニング → `output/03_slides_tuned.json`
4. Markdown生成 → `output/slides_src/deck.md`
5. PDF生成 → `output/slides_export/deck.pdf`

#### Markdownだけを単独でPDF化

既にMarkdownファイルが生成されている場合:

```bash
npm run render:pdf
```

### 方法2: ステップごとに実行

各ステップを個別に実行する場合:

#### ① セクション分割とメタ情報付与

```bash
npm run sections
```

**入力:**
- `input/script_final.md` - Markdown形式のテキスト原稿

**出力:**
- `output/01_sections.json` - セクションごとに分割されたJSON

**処理内容:**
- Markdownの見出し(`##`)でセクションを分割
- 各セクションにインテント（意図）を自動付与
  - `intro`: 導入
  - `point`: ポイント・注意事項
  - `example`: 例示
  - `comparison`: 比較
  - `process`: プロセス・手順
  - `recap`: まとめ
  - `cta`: 行動喚起
- 各セクションの概要を抽出

**出力例:**
```json
{
  "sections": [
    {
      "id": "sec-1",
      "summary": "RAG最適化への警鐘と本記事の目的",
      "intent": "intro",
      "lines": ["内容..."]
    }
  ]
}
```

#### ② スライド設計（テンプレート×制約）

**方法A: Claude Code 4.5 Sonnetを使用（推奨）**

Claude Code（このAI）に直接依頼して、`01_sections.json`から高品質な`02_slides_plan.json`を生成させる方法です。

**手順:**
1. Claude Codeに「01_sections.jsonを読み取って02_slides_plan.jsonを生成して」と依頼
2. Claude Codeが各セクションを要約し、適切なテンプレートを選択
3. 途中で切れることなく、重要なポイントだけを抽出した高品質なプランを生成

**メリット:**
- API キー不要
- 長文を適切な長さに要約（途中で切れることがない）
- 重要なポイントだけを的確に抽出
- 制約（最大文字数、最大項目数）を完全に遵守
- すべてのテンプレートに対応

**方法B: 自動実行（フォールバック）**

```bash
npm run plan
```

**入力:**
- `output/01_sections.json` - ①で生成されたセクション情報
- `config/mapping.json` - インテント→テンプレートマッピング定義
- `config/slide.schema.json` - スライド制約定義

**出力:**
- `output/02_slides_plan.json` - スライド設計プラン

**処理内容:**
- セクションのインテントに基づいてテンプレートを選択
- スライドの制約（最大行数、最大文字数）をチェック
- フィールド（タイトル、箇条書き項目など）を抽出

**注意:** この方法では、長文が途中で「...」で切れる可能性があります。高品質な要約が必要な場合は、**方法A: Claude Code 4.5 Sonnet**の使用を推奨します。

**テンプレート種類:**

**基本テンプレート:**
- `title_card`: タイトルカード
- `bullets`: 箇条書き（3〜5項目）
- `definition`: 定義
- `process`: プロセス・手順
- `comparison`: 比較
- `recap`: まとめ
- `cta`: 行動喚起
- `illustration`: イラスト付き
- `diagram`: 図解付き

**PDFテンプレート対応（`input/slide_templates_from_image.pdf`準拠）:**
- `strong_title`: 強調メッセージ（中央に大きなタイトル）
- `list_toc`: 目次/箇条書きリスト（5項目まで）
- `illustrations`: イラスト/サムネイル画像付き
- `screenshots`: スクリーンショット2枚レイアウト

**出力例:**
```json
{
  "slides": [
    {
      "template": "bullets",
      "fields": {
        "title": "RAG最適化への警鐘",
        "items": ["項目1", "項目2", "項目3"]
      },
      "constraintsResult": {
        "maxLines": 5,
        "maxCharsPerLine": 40,
        "estimatedLines": 3
      }
    }
  ]
}
```

#### ③ プロンプト設計と自動チューニング

```bash
npm run tune
```

**入力:**
- `output/02_slides_plan.json` - ②で生成されたスライド設計
- `config/slide.schema.json` - スライド制約定義

**出力:**
- `output/03_slides_tuned.json` - チューニング結果とスライド情報
- コンソールに品質チェック結果を表示

**処理内容:**
- 行数超過チェック
- 文字数超過チェック
- 必要項目不足チェック
- チューニング結果をJSONで出力

**出力例:**
```json
{
  "summary": {
    "total": 7,
    "ok": 3,
    "warn": 4
  },
  "tuneResults": [
    {
      "sectionId": "S001",
      "template": "bullets",
      "status": "OK",
      "issues": [],
      "constraints": { "maxLines": 5, "estimatedLines": 3 }
    }
  ],
  "slidesWithTuning": [ /* 元のスライド情報 */ ]
}
```

**注意:** 現在の実装は静的チェックのみです。実際のプロンプトチューニング（LLM連携）は未実装です。

#### ④ スライド生成（Markdown/HTML/CSS形式）

```bash
npm run render:md
```

**入力:**
- `output/03_slides_tuned.json` - ③で生成されたチューニング済みスライド情報
- `config/theme.css` - Marp用テーマファイル（任意）
- `input/slide_templates_from_image.pdf` - PDFテンプレート定義（参照用）

**出力:**
- `output/slides_src/deck.md` - Marp形式のMarkdownファイル

**処理内容:**
- スライド情報をMarp形式のMarkdownに変換
- テンプレートごとに適切なMarkdown構文を生成
- `input/slide_templates_from_image.pdf`のテンプレートに沿った出力に対応

**テンプレート種類:**

**基本テンプレート:**
  - `title_card`: 見出し1 + サブタイトル
  - `bullets`: 見出し2 + 箇条書き
  - `process`: 見出し2 + 番号付きリスト
  - `comparison`: 見出し2 + テーブル
  - `recap`: 見出し2 + 箇条書き（まとめ）
  - `cta`: 見出し2 + メッセージ + リンク
  - `diagram`: 見出し2 + 図解プレースホルダー
  - `illustration`: 見出し2 + イラストプレースホルダー

**PDFテンプレート対応（`input/slide_templates_from_image.pdf`準拠）:**
  - `strong_title`: 強調メッセージ（中央に大きなタイトル表示）
  - `list_toc`: 目次/箇条書きリスト（5項目まで）
  - `illustrations`: イラスト/サムネイル画像付きスライド
  - `screenshots`: スクリーンショット2枚レイアウト

**テンプレート選択ロジック:**
- `config/mapping.json`でインテント（意図）ごとに使用可能なテンプレートを定義
- 各セクションのインテントに基づいて最適なテンプレートが自動選択される
- 例: `intro`インテント → `title_card`, `strong_title`, `definition`から選択

**出力例:**
```markdown
---
marp: true
paginate: true
---

# RAG最適化への警鐘

**本記事の目的と構成**

---

## ポイント

- 項目1
- 項目2
- 項目3
```

**Markdownファイルの活用:**
- テキストエディタで直接編集可能
- Marpでプレビュー表示
- バージョン管理が容易
- HTMLやPDFに変換可能

### 任意: PDF/HTML生成

#### PDF生成（Markdown → PDF変換）

```bash
npm run render:pdf
```

**入力:**
- `output/slides_src/deck.md` - ④で生成されたMarkdownファイル
- `config/theme.css` - Marpテーマ（任意）

**出力:**
- `output/slides_export/deck.pdf` - PDFスライド

**処理内容:**
- Marp CLIを使用してMarkdownをPDFに変換
- テーマファイルを適用
- ページネーション付きのスライドPDFを生成

**注意:**
- Marp CLIは初回実行時に自動ダウンロードされます（`npx`使用）
- 頻繁に使用する場合は `npm i -D @marp-team/marp-cli` でインストール推奨

#### HTML生成（Markdown → HTML変換）

```bash
npx @marp-team/marp-cli output/slides_src/deck.md -o output/slides_export/deck.html --allow-local-files --theme-set config/theme.css
```

**出力:**
- `output/slides_export/deck.html` - HTMLスライド

**活用方法:**
- ブラウザで表示・プレゼンテーション
- Webサイトに埋め込み
- カスタムCSSでスタイル変更

## 原稿の準備方法

### ファイル配置

新しい原稿を処理する場合:

1. `input/` フォルダに原稿ファイルを配置
2. ファイル名を `script_final.md` にする（または `package.json` の `sections` スクリプトで入力ファイルパスを変更）

### 原稿フォーマット

Markdown形式で記述してください:

```markdown
## セクション1のタイトル

セクション1の内容。
複数行にわたって記述できます。

## セクション2のタイトル

セクション2の内容。

- 箇条書きも使えます
- 項目2
- 項目3
```

### 推奨事項

1. **見出しを明確に**: `##` でセクションを明確に分ける
2. **簡潔に**: 1セクション＝1スライドを意識
3. **箇条書き活用**: 箇条書きは自動的に検出されます
4. **行数制限**: 1スライドあたり最大5行程度を目安に

## トラブルシューティング

### エラー: `Cannot find module`

**原因:** Node.jsの依存パッケージが不足している

**解決策:**
```bash
npm install
```

### エラー: Marp CLIの実行に失敗

**原因:** ネットワーク接続やnpxの問題

**解決策:**
- インターネット接続を確認
- Marp CLIをローカルにインストール: `npm i -D @marp-team/marp-cli`
- インストール後、再度 `npm run render:pdf` を実行

### スライドの表示が崩れる

**原因:** テーマファイルやMarkdownの構文エラー

**解決策:**
- `config/theme.css` の構文を確認
- `output/slides_src/deck.md` のMarkdown構文を確認
- Marpのドキュメントを参照: https://marpit.marp.app/

## 出力ファイルの確認方法

### ① 01_sections.jsonの確認

```bash
cat output/01_sections.json | python -m json.tool
```

セクション分割とインテント付与の結果を確認できます。

### ② 02_slides_plan.jsonの確認

```bash
cat output/02_slides_plan.json | python -m json.tool
```

各スライドのテンプレート選択と制約チェックの結果を確認できます。

### ③ 03_slides_tuned.jsonの確認

```bash
cat output/03_slides_tuned.json | python -m json.tool
```

チューニング結果（OK/WARN）と問題箇所を確認できます。

### ④ Markdownファイルの確認

テキストエディタで開く:

```bash
# Windowsの場合
notepad output/slides_src/deck.md

# macOS/Linuxの場合
cat output/slides_src/deck.md
```

または、VSCodeなどのエディタで直接編集できます。

### ⑤ PDF/HTMLファイルの確認

**PDFの場合:**
```bash
# Windowsの場合
start output/slides_export/deck.pdf

# macOS/Linuxの場合
open output/slides_export/deck.pdf
```

**HTMLの場合:**
```bash
# Windowsの場合
start output/slides_export/deck.html

# macOS/Linuxの場合
open output/slides_export/deck.html
```

## カスタマイズ方法

### インテント→テンプレートマッピングの変更

`config/mapping.json` を編集:

```json
{
  "intro": ["title_card"],
  "point": ["bullets", "definition"],
  "example": ["bullets", "illustration"],
  ...
}
```

### スライド制約の変更

`config/slide.schema.json` を編集:

```json
{
  "bullets": {
    "maxLines": 5,
    "maxCharsPerLine": 40
  }
}
```

### Marpテーマのカスタマイズ

`config/theme.css` を編集してスライドのデザインを変更:

```css
section {
  font-family: 'Noto Sans JP', sans-serif;
  font-size: 36px;
  background-color: #1a1a2e;
  color: #eee;
}

h1 {
  font-size: 64px;
  color: #16c79a;
}

h2 {
  font-size: 48px;
  color: #19d3da;
}
```

**カスタマイズ例:**
- フォントサイズの調整
- 背景色・文字色の変更
- 余白やレイアウトの調整
- カスタムフォントの指定

詳細は Marp公式ドキュメント を参照: https://marpit.marp.app/theme-css

## システムフロー全体図

```
input/script_final.md
        ↓
  [① 03_sections.js]
        ↓
output/01_sections.json
        ↓
  [② 04_plan.js] ← config/mapping.json
        ↓            config/slide.schema.json
output/02_slides_plan.json
        ↓
  [③ 05_tune.js] ← config/slide.schema.json
        ↓
output/03_slides_tuned.json
        ↓
  [④ 06_render.js] ← config/theme.css (任意)
        ↓
output/slides_src/deck.md
        ↓
  [Marp CLI] (任意)
        ↓
output/slides_export/
  ├── deck.pdf
  └── deck.html
```

## よくある質問（FAQ）

**Q: 原稿を変更したら、全部実行し直す必要がありますか？**

A: はい。以下のコマンドを実行してください:
- Markdown形式のみ: `npm run build`
- Markdown + PDF形式: `npm run build:pdf`

**Q: 特定のスライドだけ修正したい場合は？**

A: 2つの方法があります:
1. **JSONファイルを編集**: `output/02_slides_plan.json` または `output/03_slides_tuned.json` を手動で編集してから、`npm run render:md` を実行
2. **Markdownを直接編集**: `output/slides_src/deck.md` を直接編集（最も簡単）

**Q: Markdownファイルを手動で編集できますか？**

A: はい。`output/slides_src/deck.md` をテキストエディタで直接編集できます。Marp形式のMarkdownなので、通常のMarkdown編集と同様に扱えます。編集後、`npm run render:pdf` でPDFを再生成してください。

**Q: テンプレート（テキスト形式）を追加したい場合は？**

A:
1. `src/06_render.js` の `tpl` オブジェクトに新しいテンプレート関数を追加
2. `config/mapping.json` で新しいテンプレート名をインテントにマッピング
3. 必要に応じて `config/slide.schema.json` に制約を追加

**Q: PDFではなくHTMLで出力したい場合は？**

A: 以下のコマンドを実行してください:
```bash
npx @marp-team/marp-cli output/slides_src/deck.md -o output/slides_export/deck.html --allow-local-files --theme-set config/theme.css
```

**Q: スライドのデザインを変更したい場合は？**

A: `config/theme.css` を編集してください。フォント、色、サイズ、余白などをカスタマイズできます。詳細はMarp公式ドキュメントを参照: https://marpit.marp.app/theme-css

**Q: 英語の原稿でも使えますか？**

A: 可能ですが、インテント検出の正規表現（`src/03_sections.js`）は日本語向けに調整されています。英語向けに修正が必要です。

## まとめ

### 基本的な使い方

1. 原稿を `input/script_final.md` に配置
2. `npm run build` を実行（PDFも必要な場合は `npm run build:pdf`）
3. 以下のファイルが生成されます:
   - `output/01_sections.json` - セクション分割結果
   - `output/02_slides_plan.json` - スライド設計
   - `output/03_slides_tuned.json` - チューニング結果
   - `output/slides_src/deck.md` - Marp形式のMarkdownファイル
   - `output/slides_export/deck.pdf` - PDFスライド（`build:pdf`の場合）
4. `output/slides_src/deck.md` をテキストエディタで編集可能
5. `output/slides_export/deck.pdf` を開いて確認（PDF生成した場合）

### 出力形式と活用方法

- **Markdown形式** (`deck.md`):
  - テキストエディタで直接編集可能
  - Gitでバージョン管理が容易
  - 軽量で取り扱いやすい

- **PDF形式** (`deck.pdf`):
  - プレゼンテーション用の最終成果物
  - 配布や共有に最適
  - 印刷にも対応

- **HTML形式** (`deck.html`):
  - ブラウザでプレゼンテーション
  - Webサイトに埋め込み可能
  - インタラクティブな要素の追加が可能

### カスタマイズのポイント

- **デザイン変更**: `config/theme.css` を編集
- **インテント調整**: `config/mapping.json` を編集
- **制約変更**: `config/slide.schema.json` を編集
- **テンプレート追加**: `src/06_render.js` を編集

以上で、YouTube解説動画用のスライドが自動生成されます。

## 生成されるファイルについて

各ステップの出力ファイルは、処理の透明性を確保し、デバッグや手動調整を容易にするために個別に保存されます。

- **01_sections.json**: 原稿がどのようにセクション分割され、各セクションにどのインテントが付与されたかを確認できます
- **02_slides_plan.json**: 各セクションがどのテンプレートにマッピングされ、制約チェックの結果がどうなったかを確認できます
- **03_slides_tuned.json**: チューニング（品質チェック）の結果、どのスライドに問題があるかを確認できます
- **slides_src/deck.md**: Marp形式のMarkdownファイル。テキストエディタで直接編集可能です
- **slides_export/deck.pdf**: 最終的なPDFスライド（`npm run build:pdf` を実行した場合）
- **slides_export/deck.html**: HTMLスライド（`npx marp-cli` でHTML出力した場合）

途中のファイルを手動で編集することで、細かい調整が可能です。特に `deck.md` は直接編集が推奨されます。

## スライドのデザインについて

本システムのスライドデザインは、`config/theme.css` で完全にカスタマイズできます:

- **フォント**: `font-family`、`font-size` で調整
- **色**: `background-color`、`color` で背景色・文字色を変更
- **レイアウト**: `padding`、`margin` で余白を調整
- **見出しスタイル**: `h1`、`h2`、`h3` のスタイルをカスタマイズ

デフォルトでは日本語フォント（Noto Sans JP、BIZ UDP Gothic）を優先して使用します。詳細はMarp公式ドキュメントを参照してください。
